import torch
from transformers import RobertaTokenizer,BertTokenizer,XLNetTokenizer
from transformers import AdamW, AutoModel, AutoTokenizer,get_linear_schedule_with_warmup

from summarizer import summarize # mahshid commented this
# tokenizer = RobertaTokenizer.from_pretrained("roberta-base")
import random
import re

def make_tokenizer(args):
  if args.model == "xlnet":
    return XLNetTokenizer.from_pretrained("xlnet-base-cased")
  
  if args.model == "bert":
    return BertTokenizer.from_pretrained("bert-base-uncased")
  
  if args.model == "roberta":
    #return RobertaTokenizer.from_pretrained("roberta-base")
    return AutoTokenizer.from_pretrained("roberta-base")

  

def get_clean_line(line):

    clean_line = ""

    line = line.replace("â€™", "")
    line = line.replace("'", "")
    line = line.replace("-", " ") #replace hyphens with spaces
    line = line.replace("\t", " ")
    line = line.replace("\n", " ")
    line = line.lower()

    for char in line:
        if char in 'qwertyuiopasdfghjklzxcvbnm,.?!;':
            clean_line += char
        else:
            clean_line += ' '

    clean_line = re.sub(' +',' ',clean_line) #delete extra spaces
    if clean_line[0] == ' ':
        clean_line = clean_line[1:]
    if clean_line[-1] == " ":
        clean_line = clean_line[:-1]
    return clean_line

class multiLabelDataset(torch.utils.data.Dataset):
    def __init__(self,dataset_name,max_num,seed=41,split="train",aug_methods="summary"):
    #def __init__(self,dataset_name,max_num,seed=41,split="train",aug_methods="synonym"):

        random.seed(seed)
        #num_labels = 3
        if dataset_name == "imdb":
          num_labels = 2
        if dataset_name == "ag_news":
          num_labels = 4
        print(dataset_name)
        if dataset_name == "yahoo":
          print("here")
          num_labels = 10
        if dataset_name == "csn" or dataset_name == "csn-ambig" or dataset_name == "reations" or dataset_name == "explorations" or dataset_name == "interpretations":
          num_labels = 3
          
          
          
        if dataset_name == "meld" or dataset_name == "meld-synonym" or dataset_name == "meld-backt":
          print("here")
          num_labels = 7
        print(dataset_name)
        
        if dataset_name == "yelp" or "yelp" in dataset_name:
            print("here")
            num_labels = 2  
        #print('num_labels', num_labels)
        
        
        if dataset_name == "csn-with-synonym" or "csn-with-synonym" in dataset_name or dataset_name == "csn-backt":
            print("here")
            num_labels = 3  
        #print('num_labels', num_labels)
        
        
        if dataset_name == "reactions-synonym" or "reactions-synonym" in dataset_name or dataset_name == "reactions-backt":
            print("here")
            num_labels = 3  
        
        if dataset_name == "interpretation-synonym" or "interpretation-synonym" in dataset_name or dataset_name == "interpretation-backt":
            print("here")
            num_labels = 3  
            
            
            
        if dataset_name == "explanation-synonym" or "explanation-synonym" in dataset_name or dataset_name == "explanation-backt":
            print("here")
            num_labels = 3  
        
        if dataset_name == "jigsaw_toxicity" or "jigsaw" in dataset_name:
          print("here")
          num_labels = 2
          print('num_labels', num_labels)
        
        print("aug_methods", aug_methods)
        
        
        if dataset_name == "reactions" or "reactions" in dataset_name:
            print("here")
            num_labels = 3
            print('num_labels', num_labels)
        if dataset_name == "interpretation" or "interpretation" in dataset_name:
            print("here")
            num_labels = 3
            print('num_labels', num_labels)
            
        if dataset_name == "explanations" or "explanations" in dataset_name:
            print("here")
            num_labels = 3
            print('num_labels', num_labels)   
        # print('######## num_labels #########', num_labels)
        num_per_class = int(max_num / num_labels)
        print("max_num",max_num, "num_per_class", num_per_class)

        if dataset_name == "yahoo":
          num_per_class = 16
        if split == "test":
          num_per_class = int(1000 / num_labels)
          print('************ test per class ***********', num_per_class)
        

        temp = {i:[] for i in range(num_labels)}
        #print(888888888, temp)
        with open ("../processed_data/" + dataset_name + "/seed-{}/".format(int(seed)) + split + "/data") as fin:
          text = fin.readlines()
          print('rrrrrrrrrrrrrrrrr', len(text))

        labels = torch.load("../processed_data/" + dataset_name + "/seed-{}/".format(int(seed)) + split + "/labels")

        
        
        if split=="train" and "+" in aug_methods:
          text += text
          labels += labels
          with open ("../processed_data/" + dataset_name + "/seed-{}/".format(int(seed)) + "train/" + "summary") as fin:
            aug_data = fin.readlines()
          with open ("../processed_data/" + dataset_name + "/seed-{}/".format(int(seed)) + "train/" + "eda") as fin:
            aug_data += fin.readlines()
        if split=="train" and "+" not in aug_methods:
          with open ("../processed_data/" + dataset_name + "/seed-{}/".format(int(seed)) + "train/" + aug_methods) as fin:
            aug_data = fin.readlines()

        if split is "test":
          aug_data = text


        print(len(text))
        print(len(labels))
        print(len(aug_data))

        for i in range(len(text)):
          x,y,s = text[i].strip(),labels[i],aug_data[i].strip()
          if (split == "train") and (aug_methods == "summary"):
            s = s.replace("<q>",". ")
            if "....." in s or "this this this" in s or "is is is" in s:
              s = summarize(text)

          temp[y].append((y,get_clean_line(x),get_clean_line(s)))
        #print(9999999999, temp[0])
        self.data = []
        for i in range(num_labels):
          random.shuffle(temp[i])
          #print(777777777, temp[i][:num_per_class])
          self.data += temp[i][:num_per_class]
        random.shuffle(self.data)

    def __getitem__(self,index):
        return self.data[index]

    def __len__(self):
        return len(self.data)
        
########################################################################
class multiLabelTwoDataset(torch.utils.data.Dataset):
    def __init__(self,dataset_name, d2,max_num,seed=41,split="train",aug_methods="summary"):
        random.seed(seed)
        num_labels = 3
        if dataset_name == "imdb":
          num_labels = 2
        if dataset_name == "ag_news":
          num_labels = 4
        print(dataset_name)
        if dataset_name == "yahoo":
          print("here")
          num_labels = 10
          
        if dataset_name == "csn" or dataset_name == "csn-ambig" or dataset_name == "reactions" or dataset_name == "explorations" or dataset_name == "interpretations":
          num_labels = 3
          
        if dataset_name == "meld" or "meld" in dataset_name:
          print("here")
          num_labels = 7 
          
        if dataset_name == "yelp" or "yelp" in dataset_name:
            print("here")
            num_labels = 2  
        print('num_labels', num_labels)
        
     
        if dataset_name == "jigsaw_toxicity" or "jigsaw" in dataset_name:
          print("here")
          num_labels = 2
        print('num_labels', num_labels)
        

        print(dataset_name)
        print(d2)
        

        print("aug_methods", aug_methods)
        num_per_class = int(max_num / num_labels)
        print("max_num",max_num, "num_per_class", num_per_class)

        if dataset_name == "yahoo":
          num_per_class = 16
        if split == "test":
          num_per_class = int(1000 / num_labels)
        

        temp = {i:[] for i in range(num_labels)}
        with open ("../processed_data/" + dataset_name + "/seed-{}/".format(int(seed)) + split + "/data") as fin:
          text = fin.readlines()

        labels = torch.load("../processed_data/" + dataset_name + "/seed-{}/".format(int(seed)) + split + "/labels")
        
        
        temp2 = {i:[] for i in range(num_labels)}
        with open ("../processed_data/" + d2 + "/seed-{}/".format(int(seed)) + split + "/data") as fin:
          text2 = fin.readlines()

        labels2 = torch.load("../processed_data/" + d2 + "/seed-{}/".format(int(seed)) + split + "/labels")

        
        # add back-translation and synonym here
        if split=="train" and "+" in aug_methods:
          text += text
          labels += labels
          with open ("../processed_data/" + dataset_name + "/seed-{}/".format(int(seed)) + "train/" + "summary") as fin:
            aug_data = fin.readlines()
          with open ("../processed_data/" + dataset_name + "/seed-{}/".format(int(seed)) + "train/" + "eda") as fin:
            aug_data += fin.readlines()
        if split=="train" and "+" not in aug_methods:
          with open ("../processed_data/" + dataset_name + "/seed-{}/".format(int(seed)) + "train/" + aug_methods) as fin:
            aug_data = fin.readlines()
            
        
        if split=="train" and "+" in aug_methods:
          text2 += text2
          labels2 += labels2
          with open ("../processed_data/" + d2 + "/seed-{}/".format(int(seed)) + "train/" + "summary") as fin:
            aug_data2 = fin.readlines()
          with open ("../processed_data/" + d2 + "/seed-{}/".format(int(seed)) + "train/" + "eda") as fin:
            aug_data2 += fin.readlines()
        if split=="train" and "+" not in aug_methods:
          with open ("../processed_data/" + d2 + "/seed-{}/".format(int(seed)) + "train/" + aug_methods) as fin:
            aug_data2 = fin.readlines()

        if split is "test":
          aug_data = text
          aug_data2 = text2

        print(len(text))
        print(len(labels))
        print(len(aug_data))

        print(len(text2))
        print(len(labels2))
        print(len(aug_data2))

        
        for i in range(len(text)):
          x,y,s = text[i].strip(),labels[i],aug_data[i].strip()
          if (split == "train") and (aug_methods == "summary"):
            s = s.replace("<q>",". ")
            if "....." in s or "this this this" in s or "is is is" in s:
              s = summarize(text)

          temp[y].append((y,get_clean_line(x),get_clean_line(s)))
        
        for i in range(len(text2)):
          x2,y2,s2 = text2[i].strip(),labels2[i],aug_data2[i].strip()
          if (split == "train") and (aug_methods == "summary"):
            s2 = s2.replace("<q>",". ")
            if "....." in s2 or "this this this" in s2 or "is is is" in s2:
              s2 = summarize(text2)

          temp2[y2].append((y2,get_clean_line(x2),get_clean_line(s2)))
        
        
        self.data = []
        self.data2 = []
        for i in range(num_labels):
          random.shuffle(temp[i])
          self.data += temp[i][:num_per_class]
        random.shuffle(self.data)
        
        
        for i in range(num_labels):
          random.shuffle(temp2[i])
          self.data2 += temp2[i][:num_per_class]
        random.shuffle(self.data2)
        #print('0000000000000000000', self.data2)

    def __getitem__(self,index):
        if index < len(self.data) and index < len(self.data2):
        
            return self.data[index], self.data2[index]

    def __len__(self):
        return min(len(self.data), len(self.data2))




###########################################################################

def collate_fn_mix(batch):
    batch_size = len(batch)
    perm_index = torch.randperm(batch_size)
    y_a = torch.LongTensor([item[0] for item in batch])
    y_b = y_a[perm_index]
    x = [item[1] for item in batch]
    s = [item[2] for item in batch]
    s_perm = [s[perm_index[i]] for i in range(batch_size)]
    s_mix = [s[i] + "\n" + s_perm[i] for i in range(batch_size)]

    # x_ids = tokenizer(x, padding = 'max_length', max_length = 200, truncation = True, return_tensors="pt")["input_ids"]
    # s_mix_ids = tokenizer(s_mix, padding = 'max_length', max_length = 200, truncation = True, return_tensors="pt")["input_ids"]

    return x, s_mix, y_a, y_b

def collate_fn_feature_mix(batch):

  batch_size = len(batch) # 32
  perm_index = torch.randperm(batch_size) 
  #perm_index: tensor([14, 25, 11, 30, 23, 27, 16, 17, 19,  7,  4, 10,  0,  6, 18, 24, 22, 12, 29,  9,  1, 28,  3, 13, 20, 21,  8, 31, 26,  2,  5, 15])
  
  
  y_a = torch.LongTensor([item[0] for item in batch])
  y_b = y_a[perm_index]
  
  #y_a: tensor([4, 2, 0, 1, 2, 0, 2, 1, 0, 0, 0, 1, 1, 2, 4, 4, 2, 4, 2, 3, 4, 1, 1, 0,2, 4, 3, 4, 4, 0, 0, 4]) 
  #y_b: tensor([4, 4, 1, 0, 0, 4, 2, 4, 3, 1, 2, 0, 4, 2, 2, 2, 1, 1, 0, 0, 2, 4, 1, 2,4, 1, 0, 4, 3, 0, 0, 4])
  
  
  # item[0] = label, item[1]=x, item[2]= s, x and s are exactly same. 
  x = [item[1] for item in batch]
  s = [item[2] for item in batch]
  # xxxxxxxxxxxxxxx ['words cannot express the warm welcome and friendly nature of this business. i had the opportunity of working with k who was knowledgable and courteous. i had dropped my iphone in water, and he was able to fix the phone to take it from inoperable to working flawlessly. you are insane to go anywhere else. great price, great people, great service. i wish i could give it a . n n n n doug', 'the location of il fornaio is great...nice to be able to sit out and watch people in the casino. the service was also really great. n nhowever, although the food was good, i struggle to give more than stars, because i thought the price tag was really high for what we ordered.', 'if i could give this place a negative rating i would. my wife, year old daughter and myself stopped in for lunch expecting a nice lunch. well, as we all know they play latin music in their establishments. on this particular day they decided to play whatever they wanted. while eating i noticed that there were f bombs ad s bombs being played over the speakers. i asked for the manager to complain and he gave me some excuse that they have no control over the music. bull shit!! i asked for the corporate number and gave them a call. turns out they have assigned stations that are to be played. n i have no complaint about baja itself, i do have an issue with this location. and for the little sharpy eye brow wearing mexican bitch. who the hell are you to tell my wife that my daughter doesnt look like here? you might want to keep you papers near by just incase a few of my ins buddies decide to stop by for lunch.', 'this is an alright place if you havent experienced some of the much better places in arizona. i think it is somewhat overpriced compared to similar restaurants and the food isnt anything to rave about.', 'its an airport, small but had what it needed. planes.', 'love the organ... sad to see this arizona historical treasure in such danger of mediocrity due to poor management. the pizza we had wasnt worth taking home. i didnt want to insult the cardboard box by putting pizza in it that is more tasteless than itself. fix yer food folks!!!', 'i stopped in this nautica store to try and land some long sleeve fitted dress shirts, but left empty handed. n nim , lbs. it is hard to find shirts that dont look too bulky in the middle, but are still long enough in the arms. an ideally fitted shirt for my frame is a in the neck, in the arms and trim through the midsection. n nnautica, it turns out, has some really nice fitted dress shirts at this store marked down, but they only carry in the arms in a in the neck size. two of the girls there were very helpful trying to find the appropriate size, but after a quick check at the reference book, it turns out they didnt carry what i needed. n nthree stars for the two young ladies who made an effort to find what i needed, before they finally recommended i shop at calvin klein instead. n ntheir recommendation was heeded. nautica, ill sail you some other time.', 'the first time i went here i thought it was a good yelp pick. the last time i went here i shelled out for a scramble without meat, and a large oj. if you come here with a party of four your tab would be close to . . for a large oj that was probably bought at costco for a gallon!? food is good, but not worth the high cost and wait considering the location is in an industrial area. i have been to hundreds of restaurants world wide and know what is a reasonable cost for your meal. diners and dives made it popular, but now i think they are gouging the customer for their product. cashier tried to justify costs, but the s just dont add up.', 'the fish on the sushi gave my friend food poisoning. worse part is the manager is literally watching you from the cameras in the back. n nthe worst part is that if you order more of the same sushi they reduce the fish portion and increase the rice amount. i only tasted sticky rise!!!', 'waited for an hour during lunch. they took my order, waited forever, and ended up having to leave without eating because i needed to get back to work.', 'were here because of a convention. first bad thing is the location. its far away from everything else that is fun. we walked back from the strip and its a full mile of rather dangerous and unpleasant walk on a sidewalk that smells of sewage next to speeding cars and a walking bridge that is befitting of a ghetto. n nthe novice black jack dealer was a little cute and mildly entertaining. she almost gave us push on a lost hand which the whole table laughed about. n nin the morning it took minutes for a hostess to acknowledge us in line to be seated at the half empty breakfast restaurant. we werent allowed to bring coffee from their own restaurant to the pool area. some guy didnt like us moving poolside chairs into a shade. n nits not one thing, but a collage of a bunch of wrong things that paints an ugly picture for this resort. we wont be back.', 'i ordered custom counter tops and had them installed by lowes in my laundry room. the color was what i had been looking for in a quartz. the installers somehow scratched must had been with a saw the top of the counter top. i complained and they came out and fixed it by polishing a small section. now i have a shiny spot in the middle of the counter top. ni am so disappointed. i spent for this and see the shiny spot every time i walk through the room. they are functional, but this is so disappointing. dont have any custom work done.', 'simply put...ive had better. i ordered two meals with fried rice. the rice contained hard pieces that were uneatable, yuck! crab ragoons had an imitation crab flavor and sadly to say, i think panda express does it better.', 'i am a fan of the deals you can get here, all that digging is so satisfying when you get designer items and you manage to find something that is either not damaged or something you can repair. that being said dealing with the other people makes me dislike people more than working at mcdonalds in high school. they have security guards who will kick you out if you are not following the rules when they put out new items, i have seen people steal items out of other peoples carts ect. this place is so not my cup of tea but there are definately great deals to be had if you like people more than i apparently do.', 'cibo itself is a oxymoron. very cozy but large. very romantic but busy. i will explain that later. this italian restaurant is that but much more. on the corner of north th avenue and west filmore. at night, you will see a house lit up with strings of white lights and the sound of a guitar playing sweet melodies. ngetting there was a small challenge for me. not being from phoenix and not being familiar with side streets. my main route was using the freeway. which i am not a particular fan of. nthis night, friday, was filled with a lot of ambulances, cop cars and fire trucks with lights and sirens blazing. one incident, my wife counted around of these emergency vehicles going the other way on the freeway at the same time. i just pray that they all got there on time to help the people who were in need. ngetting closer to the restaurant. you can see the tall buildings of downtown. we were following the maps app but a lot of the streets are not well lit. so we missed a street or two. luckily we did find the restaurant. again the strings of white lights and the guitar music were a good indicator that we were here. plenty of parking on west filmore street. nbesides the front patio dining. they have a small bar once your inside. the bar itself holds, at most, individuals. a good selection of bottled beers, wine and shots of different cocktails. my wife tried a limoncello drink that she thought was real good. too bad she got the last one so she couldnt order another. nwhat makes this restaurant cozy but large is the inside of the restaurant is broken up into smaller rooms. so you never see everyone who is dining there. you can just focus on your present company and the meal you are sharing. this also explains the being romantic and busy part. waiting for your table you see servers and patrons going back and forth. its not until you get seated into one of those smaller rooms that everything starts to slow down. nthe crowd that eats there is a very diverse crowd. from hipster guys and gals to men in suit and ties and women in dresses. young and old come here. nand they come for the atmosphere but mainly for the food. great italian fare. pizzas, pasta dishes, colorful salads. the food is amazing. house chop salad is great, pairs of different prepared bruschetta is great and the bolognese sausage dish that i had was so good. it was all delicious. if you come here. you will not be disappointed.', 'i absolutely love polished! i live about miles away and i pass hundreds of nail salons and i would never go anywhere but here. the color selection is like no other. i have never seen so many. it is always busy in here but i have never had to wait to get serviced. tina does my nails and she makes them look perfect each time. the receptionists arielle and brianna make everything go smoothly and they always greet you by name. whenever i have people in town i always take them to polished! i love it here!', 'there are at least four starbucks in this airport this is the one in t just inside security checkpoint c by gates c c . n na surprisingly nice airport starbucks. when i was there, it was quiet without a line. there is a seating area with four tables and three sets of four armchairs. you could actually sit here and believe that you were at any starbucks, not inside an airport. n nthe place was well staffed i believe there were three employees , and my drinks came quickly. they had bananas when i was there, which was nice, plus a limited assortment of baked goods it was later in the day .', 'i love chocolate!!!!!!!!! n ni took my daughter here for her th birthday and she love it!!! we sat on the comfy couches and ordered the chocolate fondue and it was delicious it gave me the best sensation ever!!!! n nfor all you chocolate lovers i highly recommend you stop by here and order the chocolae fondue! n nthe people there are very friendly and give you great service!', 'stopped back in here tonight heres an update since its been about a year and a half. i had a regular whataburger . a small fries . . the dining room was clean comfortable, the service friendly, the sizes of the items right for the money. the burger was well topped, with lettuce, tomato, diced raw onions, on a warm, toasted bun. the flavor of the meat was quite ordinary though, fell well short of the best burgers in town, so its another stars for this completely ok but not special place.', 'it has been a long time since ive had frozen yogurt, but i fell in love again with this somewhat healthy treat after attending saturdays at selwyn. n nmy boyfriend and i went and filled up our cups with about different flavors and piled on toppings from fresh fruit to chocolate chips and caramel. we had a coupon, which was nice considering it was our first time. the next day i decided that i needed some more yoforia in my life and we drove the almost min drive back to selwyn ave for it. n na lover of great food and anything sweet, i got my fix of raspberry yogurt. its a great after dinner snack thats not too heavy, not to mention the atmosphere is perfect. you can sit outside and enjoy the weather, people watch, etc. definitely one of my new favorite places.', 'it had been a while since i dined at lawrys las vegas, but i craved a spinning salad and a bone in piece of prime rib. i made reservations on open table literally minutes prior to my reservation and had no problem getting in. n nonce greeted by the friendly staff we were escorted to a nice roomy corner booth with a view of the entire main dinning area. our waitress has worked here for years was friendly and funny. she took my drink order while we enjoyed the complimentary warm yummy bread. i placed an order of wild mushroom medley so the timing would coincide while arturo carved my request of the lawrys bone in prime rib cut and plated my mixed cream corn spinach, mashed potatoes and yorkshire pudding. the prime rib was delish, tender and flavorful it was that moment i realized why i unconsciously wanted to dine here! all the sides were perfect and the wild mushrooms were incredible. unfortunately i was so full i had to pass on dessert, so decided to walk over to starbucks and had a nightcap frappuccino. n nill definitely return to lawrys again for the traditional food, service and convenience.', 'as far as automatic, non do it yourself car washes, this is where youll get the bang for your buck and a quick wash. if thats what youre shooting for, this place has the whole routine down! n neven with a basic wash, theyll wipe down the interior and clean the insides of the windows. thats pretty cool, but they use ammonia based cleaners to get the residue to evaporate faster. thats fine when its used in your house, but prolonged or repeated use of the stuff will dry out the vinyl and rubber seals on your car. n nthey janked up all the seat settings slid them all back so that they can get in there and wipe the dash. again, thats cool given how quick they wipe it down, but annoying. even without paying for the stinky perfume, the car still smelled like it anyway. eww. n ni believe that a diy car wash like the place out in middleton or sun prairie would be a better clean for , given you have your own sponge, cloth, soap, and bucket. if youre short on time, octopus has got your back. like joyce said, it is what it is', 'i really wanted to love this place, but it just didnt happen at all. we got a to go order of potstickers , snow crab shrimp roll, and a salmon tempura roll. we were told it would be ready in minutes on a sunday about p.m. n to start, the place is like a broom closet. as you walk in, the register is at the far end of the restaurant with literally feet between the counter and the drink stand. while waiting in line to pay, we had to maneuver around the foot space x for the wait staff. n the chefs didnt even begin to make our order until minutes after our minute arrival time. after paying, we moved to stand by the hallway to the restrooms, still seemly in the way of everyone it was very uncomfortable. on to the food n the salmon tempura roll was a sad sight, but tasted okay. the crab shrimp roll the shrimp and avocado were fresh, but the crab looked like little hairs and was poorly represented. the potstickers gyoza were a pathetic excuse for their name. they were mushy and bland. even the dipping sauce served with them was a pale representation of what it should have been. n i know of many others that are much better than this place. they can serve sushi all day long, but ill never come back.', 'first, let me say that the customer service at the sedona location is very good. the technician more than competent. she gets five stars. n nmy problem is with billing and the website. as we made payments, we never got a statement reflecting the payments even though my husband asked for corrected invoices. also wrote two letters... no response. the invoice ascension were only on the site once and then disappeared. the results never showed up when we logged on. n nnow we are told its going to collection and well have to make payment arrangements with the agency. but they dont know who the agency is or what their procedures are. interesting because weve called three times and each time been told its going to collection tomorrow .', 'very clean and not crowded on weekends. they do price match only with frys, safeway, albertson and basha.', 'i am super happy with the service i received. i called and spoke with jerry he came out the same day and gave me an estimate which was very fair. they scheduled my tree trimming for the next day! alex was great. he introduced himself right from the start and made sure we were on the same page. he and his crew did a great job! they even cleaned everything up and left it looking nicer than before they came. i highly recommend them!!! and i will use them again!', 'what is up with the hosts lately in restaurants. they have zero personality and really dont set a great first impression. anyhow lets get to food and service. carol is great and really overcomes the original impression left by the podium guards. we ordered a tomatoe caprisi appetizer and it was excellent! a new variation on a classic. tomatoes are spread out on the plate and has chopped tomaroes spread around. the new addition to this classic is fresh red onion and then a balsamic reduction and fresh basil. i could eat this dish as an main course but i dont have that much restraint. i orderes pasta franco and it was very food. the combination of olives artichoke hearts and sundried tomatoe makes this dish a little salt towards the end but it wasnt unexpected. i would order it again. carol is very attentive but never pushy and you should definitely ask for her. we dont dine here often enough but we will remedy that.', 'who cares if its a chain? as far as bang for your buck is concerned, outback has always been good in my book. it was a packed house when we got there, so we sat at the bar and paige was our bartender and she was great. she helped us get the table we wanted quickly and was very friendly. blake was our server and he was great as well. food was all very tasty. had bloomin onion, filet with wild mushroom sauce, and prime rib. while the prime rib was a little tough in some places, it was still very good overall. good prices, good food.', 'still the best and for me, the only professional football team in the world...', 'dismal, abject, revolting. these are words one would use to describe the contents of a garbage can, or a snuff film. you know nice, pleasant things that one would enjoy on a sunday afternoon. shogun however deserves none of this high praise. these words are a lofty goal by their standards. n ni was so unfortunate to collide unwillingly with this place one saturday for lunch and decided to order the unagi roll and the panko udon. i was expecting some common sense from the chef wank they picked up off the street, but even hope fails occasionally in an explosion of misery. the unagi roll was horrible. the rice was not fully cooked, the contents were soggy and tasted old. the sushi would have been better if the chef had taken the ingredients, put them down his pants, sat on them for minutes while riding a bull, and then vomited on the resulting creation. later the panko udon arrived, and it was even worse. i understand that it was panko breaded and not a tempura batter, but still it was absolutely horrendous. they could not have overcooked the vegetables, shrimp, and fish more. it was greasy, bland, insipid cooking that could not have been made better even if it were served with a diamond ring. the store bought, cheap as you can find udon was undercooked and had the texture of noodles that had been sitting for about minutes in a colander. these little beauties were served in a pool of horrific bottled tsuyu sauce that left a lingering chemical aftertaste that was just a delight to behold. n ni would not eat here again even if my scrotum were stapled to a chair and i was chained to a table. i have to give this place one star too many because yelp unfortunately has a one star minimum. i would even rate any fast food chain better than this place. i have had better airline food. n ncheers, nuntil then, get the beers in... njust not at shogun.', 'these mother fuckers hit an ran my car! eye witness took down their cab number and license plate. your busted!', 'words... osso bucco. best in town! wait, best ever! i usually have to call to see if theyre offering it for the night, but its phenomenal! no joke. its fantastic. i dont even like eating meat, and i will crave this dish! antonio and rudy behind the bar are amazing mixologists and have created some of the coolest cocktails ive ever had!']
  # sssssssssssssss ['words cannot express the warm welcome and friendly nature of this business. i had the opportunity of working with k who was knowledgable and courteous. i had dropped my iphone in water, and he was able to fix the phone to take it from inoperable to working flawlessly. you are insane to go anywhere else. great price, great people, great service. i wish i could give it a . n n n n doug', 'the location of il fornaio is great...nice to be able to sit out and watch people in the casino. the service was also really great. n nhowever, although the food was good, i struggle to give more than stars, because i thought the price tag was really high for what we ordered.', 'if i could give this place a negative rating i would. my wife, year old daughter and myself stopped in for lunch expecting a nice lunch. well, as we all know they play latin music in their establishments. on this particular day they decided to play whatever they wanted. while eating i noticed that there were f bombs ad s bombs being played over the speakers. i asked for the manager to complain and he gave me some excuse that they have no control over the music. bull shit!! i asked for the corporate number and gave them a call. turns out they have assigned stations that are to be played. n i have no complaint about baja itself, i do have an issue with this location. and for the little sharpy eye brow wearing mexican bitch. who the hell are you to tell my wife that my daughter doesnt look like here? you might want to keep you papers near by just incase a few of my ins buddies decide to stop by for lunch.', 'this is an alright place if you havent experienced some of the much better places in arizona. i think it is somewhat overpriced compared to similar restaurants and the food isnt anything to rave about.', 'its an airport, small but had what it needed. planes.', 'love the organ... sad to see this arizona historical treasure in such danger of mediocrity due to poor management. the pizza we had wasnt worth taking home. i didnt want to insult the cardboard box by putting pizza in it that is more tasteless than itself. fix yer food folks!!!', 'i stopped in this nautica store to try and land some long sleeve fitted dress shirts, but left empty handed. n nim , lbs. it is hard to find shirts that dont look too bulky in the middle, but are still long enough in the arms. an ideally fitted shirt for my frame is a in the neck, in the arms and trim through the midsection. n nnautica, it turns out, has some really nice fitted dress shirts at this store marked down, but they only carry in the arms in a in the neck size. two of the girls there were very helpful trying to find the appropriate size, but after a quick check at the reference book, it turns out they didnt carry what i needed. n nthree stars for the two young ladies who made an effort to find what i needed, before they finally recommended i shop at calvin klein instead. n ntheir recommendation was heeded. nautica, ill sail you some other time.', 'the first time i went here i thought it was a good yelp pick. the last time i went here i shelled out for a scramble without meat, and a large oj. if you come here with a party of four your tab would be close to . . for a large oj that was probably bought at costco for a gallon!? food is good, but not worth the high cost and wait considering the location is in an industrial area. i have been to hundreds of restaurants world wide and know what is a reasonable cost for your meal. diners and dives made it popular, but now i think they are gouging the customer for their product. cashier tried to justify costs, but the s just dont add up.', 'the fish on the sushi gave my friend food poisoning. worse part is the manager is literally watching you from the cameras in the back. n nthe worst part is that if you order more of the same sushi they reduce the fish portion and increase the rice amount. i only tasted sticky rise!!!', 'waited for an hour during lunch. they took my order, waited forever, and ended up having to leave without eating because i needed to get back to work.', 'were here because of a convention. first bad thing is the location. its far away from everything else that is fun. we walked back from the strip and its a full mile of rather dangerous and unpleasant walk on a sidewalk that smells of sewage next to speeding cars and a walking bridge that is befitting of a ghetto. n nthe novice black jack dealer was a little cute and mildly entertaining. she almost gave us push on a lost hand which the whole table laughed about. n nin the morning it took minutes for a hostess to acknowledge us in line to be seated at the half empty breakfast restaurant. we werent allowed to bring coffee from their own restaurant to the pool area. some guy didnt like us moving poolside chairs into a shade. n nits not one thing, but a collage of a bunch of wrong things that paints an ugly picture for this resort. we wont be back.', 'i ordered custom counter tops and had them installed by lowes in my laundry room. the color was what i had been looking for in a quartz. the installers somehow scratched must had been with a saw the top of the counter top. i complained and they came out and fixed it by polishing a small section. now i have a shiny spot in the middle of the counter top. ni am so disappointed. i spent for this and see the shiny spot every time i walk through the room. they are functional, but this is so disappointing. dont have any custom work done.', 'simply put...ive had better. i ordered two meals with fried rice. the rice contained hard pieces that were uneatable, yuck! crab ragoons had an imitation crab flavor and sadly to say, i think panda express does it better.', 'i am a fan of the deals you can get here, all that digging is so satisfying when you get designer items and you manage to find something that is either not damaged or something you can repair. that being said dealing with the other people makes me dislike people more than working at mcdonalds in high school. they have security guards who will kick you out if you are not following the rules when they put out new items, i have seen people steal items out of other peoples carts ect. this place is so not my cup of tea but there are definately great deals to be had if you like people more than i apparently do.', 'cibo itself is a oxymoron. very cozy but large. very romantic but busy. i will explain that later. this italian restaurant is that but much more. on the corner of north th avenue and west filmore. at night, you will see a house lit up with strings of white lights and the sound of a guitar playing sweet melodies. ngetting there was a small challenge for me. not being from phoenix and not being familiar with side streets. my main route was using the freeway. which i am not a particular fan of. nthis night, friday, was filled with a lot of ambulances, cop cars and fire trucks with lights and sirens blazing. one incident, my wife counted around of these emergency vehicles going the other way on the freeway at the same time. i just pray that they all got there on time to help the people who were in need. ngetting closer to the restaurant. you can see the tall buildings of downtown. we were following the maps app but a lot of the streets are not well lit. so we missed a street or two. luckily we did find the restaurant. again the strings of white lights and the guitar music were a good indicator that we were here. plenty of parking on west filmore street. nbesides the front patio dining. they have a small bar once your inside. the bar itself holds, at most, individuals. a good selection of bottled beers, wine and shots of different cocktails. my wife tried a limoncello drink that she thought was real good. too bad she got the last one so she couldnt order another. nwhat makes this restaurant cozy but large is the inside of the restaurant is broken up into smaller rooms. so you never see everyone who is dining there. you can just focus on your present company and the meal you are sharing. this also explains the being romantic and busy part. waiting for your table you see servers and patrons going back and forth. its not until you get seated into one of those smaller rooms that everything starts to slow down. nthe crowd that eats there is a very diverse crowd. from hipster guys and gals to men in suit and ties and women in dresses. young and old come here. nand they come for the atmosphere but mainly for the food. great italian fare. pizzas, pasta dishes, colorful salads. the food is amazing. house chop salad is great, pairs of different prepared bruschetta is great and the bolognese sausage dish that i had was so good. it was all delicious. if you come here. you will not be disappointed.', 'i absolutely love polished! i live about miles away and i pass hundreds of nail salons and i would never go anywhere but here. the color selection is like no other. i have never seen so many. it is always busy in here but i have never had to wait to get serviced. tina does my nails and she makes them look perfect each time. the receptionists arielle and brianna make everything go smoothly and they always greet you by name. whenever i have people in town i always take them to polished! i love it here!', 'there are at least four starbucks in this airport this is the one in t just inside security checkpoint c by gates c c . n na surprisingly nice airport starbucks. when i was there, it was quiet without a line. there is a seating area with four tables and three sets of four armchairs. you could actually sit here and believe that you were at any starbucks, not inside an airport. n nthe place was well staffed i believe there were three employees , and my drinks came quickly. they had bananas when i was there, which was nice, plus a limited assortment of baked goods it was later in the day .', 'i love chocolate!!!!!!!!! n ni took my daughter here for her th birthday and she love it!!! we sat on the comfy couches and ordered the chocolate fondue and it was delicious it gave me the best sensation ever!!!! n nfor all you chocolate lovers i highly recommend you stop by here and order the chocolae fondue! n nthe people there are very friendly and give you great service!', 'stopped back in here tonight heres an update since its been about a year and a half. i had a regular whataburger . a small fries . . the dining room was clean comfortable, the service friendly, the sizes of the items right for the money. the burger was well topped, with lettuce, tomato, diced raw onions, on a warm, toasted bun. the flavor of the meat was quite ordinary though, fell well short of the best burgers in town, so its another stars for this completely ok but not special place.', 'it has been a long time since ive had frozen yogurt, but i fell in love again with this somewhat healthy treat after attending saturdays at selwyn. n nmy boyfriend and i went and filled up our cups with about different flavors and piled on toppings from fresh fruit to chocolate chips and caramel. we had a coupon, which was nice considering it was our first time. the next day i decided that i needed some more yoforia in my life and we drove the almost min drive back to selwyn ave for it. n na lover of great food and anything sweet, i got my fix of raspberry yogurt. its a great after dinner snack thats not too heavy, not to mention the atmosphere is perfect. you can sit outside and enjoy the weather, people watch, etc. definitely one of my new favorite places.', 'it had been a while since i dined at lawrys las vegas, but i craved a spinning salad and a bone in piece of prime rib. i made reservations on open table literally minutes prior to my reservation and had no problem getting in. n nonce greeted by the friendly staff we were escorted to a nice roomy corner booth with a view of the entire main dinning area. our waitress has worked here for years was friendly and funny. she took my drink order while we enjoyed the complimentary warm yummy bread. i placed an order of wild mushroom medley so the timing would coincide while arturo carved my request of the lawrys bone in prime rib cut and plated my mixed cream corn spinach, mashed potatoes and yorkshire pudding. the prime rib was delish, tender and flavorful it was that moment i realized why i unconsciously wanted to dine here! all the sides were perfect and the wild mushrooms were incredible. unfortunately i was so full i had to pass on dessert, so decided to walk over to starbucks and had a nightcap frappuccino. n nill definitely return to lawrys again for the traditional food, service and convenience.', 'as far as automatic, non do it yourself car washes, this is where youll get the bang for your buck and a quick wash. if thats what youre shooting for, this place has the whole routine down! n neven with a basic wash, theyll wipe down the interior and clean the insides of the windows. thats pretty cool, but they use ammonia based cleaners to get the residue to evaporate faster. thats fine when its used in your house, but prolonged or repeated use of the stuff will dry out the vinyl and rubber seals on your car. n nthey janked up all the seat settings slid them all back so that they can get in there and wipe the dash. again, thats cool given how quick they wipe it down, but annoying. even without paying for the stinky perfume, the car still smelled like it anyway. eww. n ni believe that a diy car wash like the place out in middleton or sun prairie would be a better clean for , given you have your own sponge, cloth, soap, and bucket. if youre short on time, octopus has got your back. like joyce said, it is what it is', 'i really wanted to love this place, but it just didnt happen at all. we got a to go order of potstickers , snow crab shrimp roll, and a salmon tempura roll. we were told it would be ready in minutes on a sunday about p.m. n to start, the place is like a broom closet. as you walk in, the register is at the far end of the restaurant with literally feet between the counter and the drink stand. while waiting in line to pay, we had to maneuver around the foot space x for the wait staff. n the chefs didnt even begin to make our order until minutes after our minute arrival time. after paying, we moved to stand by the hallway to the restrooms, still seemly in the way of everyone it was very uncomfortable. on to the food n the salmon tempura roll was a sad sight, but tasted okay. the crab shrimp roll the shrimp and avocado were fresh, but the crab looked like little hairs and was poorly represented. the potstickers gyoza were a pathetic excuse for their name. they were mushy and bland. even the dipping sauce served with them was a pale representation of what it should have been. n i know of many others that are much better than this place. they can serve sushi all day long, but ill never come back.', 'first, let me say that the customer service at the sedona location is very good. the technician more than competent. she gets five stars. n nmy problem is with billing and the website. as we made payments, we never got a statement reflecting the payments even though my husband asked for corrected invoices. also wrote two letters... no response. the invoice ascension were only on the site once and then disappeared. the results never showed up when we logged on. n nnow we are told its going to collection and well have to make payment arrangements with the agency. but they dont know who the agency is or what their procedures are. interesting because weve called three times and each time been told its going to collection tomorrow .', 'very clean and not crowded on weekends. they do price match only with frys, safeway, albertson and basha.', 'i am super happy with the service i received. i called and spoke with jerry he came out the same day and gave me an estimate which was very fair. they scheduled my tree trimming for the next day! alex was great. he introduced himself right from the start and made sure we were on the same page. he and his crew did a great job! they even cleaned everything up and left it looking nicer than before they came. i highly recommend them!!! and i will use them again!', 'what is up with the hosts lately in restaurants. they have zero personality and really dont set a great first impression. anyhow lets get to food and service. carol is great and really overcomes the original impression left by the podium guards. we ordered a tomatoe caprisi appetizer and it was excellent! a new variation on a classic. tomatoes are spread out on the plate and has chopped tomaroes spread around. the new addition to this classic is fresh red onion and then a balsamic reduction and fresh basil. i could eat this dish as an main course but i dont have that much restraint. i orderes pasta franco and it was very food. the combination of olives artichoke hearts and sundried tomatoe makes this dish a little salt towards the end but it wasnt unexpected. i would order it again. carol is very attentive but never pushy and you should definitely ask for her. we dont dine here often enough but we will remedy that.', 'who cares if its a chain? as far as bang for your buck is concerned, outback has always been good in my book. it was a packed house when we got there, so we sat at the bar and paige was our bartender and she was great. she helped us get the table we wanted quickly and was very friendly. blake was our server and he was great as well. food was all very tasty. had bloomin onion, filet with wild mushroom sauce, and prime rib. while the prime rib was a little tough in some places, it was still very good overall. good prices, good food.', 'still the best and for me, the only professional football team in the world...', 'dismal, abject, revolting. these are words one would use to describe the contents of a garbage can, or a snuff film. you know nice, pleasant things that one would enjoy on a sunday afternoon. shogun however deserves none of this high praise. these words are a lofty goal by their standards. n ni was so unfortunate to collide unwillingly with this place one saturday for lunch and decided to order the unagi roll and the panko udon. i was expecting some common sense from the chef wank they picked up off the street, but even hope fails occasionally in an explosion of misery. the unagi roll was horrible. the rice was not fully cooked, the contents were soggy and tasted old. the sushi would have been better if the chef had taken the ingredients, put them down his pants, sat on them for minutes while riding a bull, and then vomited on the resulting creation. later the panko udon arrived, and it was even worse. i understand that it was panko breaded and not a tempura batter, but still it was absolutely horrendous. they could not have overcooked the vegetables, shrimp, and fish more. it was greasy, bland, insipid cooking that could not have been made better even if it were served with a diamond ring. the store bought, cheap as you can find udon was undercooked and had the texture of noodles that had been sitting for about minutes in a colander. these little beauties were served in a pool of horrific bottled tsuyu sauce that left a lingering chemical aftertaste that was just a delight to behold. n ni would not eat here again even if my scrotum were stapled to a chair and i was chained to a table. i have to give this place one star too many because yelp unfortunately has a one star minimum. i would even rate any fast food chain better than this place. i have had better airline food. n ncheers, nuntil then, get the beers in... njust not at shogun.', 'these mother fuckers hit an ran my car! eye witness took down their cab number and license plate. your busted!', 'words... osso bucco. best in town! wait, best ever! i usually have to call to see if theyre offering it for the night, but its phenomenal! no joke. its fantastic. i dont even like eating meat, and i will crave this dish! antonio and rudy behind the bar are amazing mixologists and have created some of the coolest cocktails ive ever had!']

 
  s_perm = [s[perm_index[i]] for i in range(batch_size)]
  x_perm = [x[perm_index[i]] for i in range(batch_size)]
  
  # x_permmmmmmmmmmmmmmm ['cibo itself is a oxymoron. very cozy but large. very romantic but busy. i will explain that later. this italian restaurant is that but much more. on the corner of north th avenue and west filmore. at night, you will see a house lit up with strings of white lights and the sound of a guitar playing sweet melodies. ngetting there was a small challenge for me. not being from phoenix and not being familiar with side streets. my main route was using the freeway. which i am not a particular fan of. nthis night, friday, was filled with a lot of ambulances, cop cars and fire trucks with lights and sirens blazing. one incident, my wife counted around of these emergency vehicles going the other way on the freeway at the same time. i just pray that they all got there on time to help the people who were in need. ngetting closer to the restaurant. you can see the tall buildings of downtown. we were following the maps app but a lot of the streets are not well lit. so we missed a street or two. luckily we did find the restaurant. again the strings of white lights and the guitar music were a good indicator that we were here. plenty of parking on west filmore street. nbesides the front patio dining. they have a small bar once your inside. the bar itself holds, at most, individuals. a good selection of bottled beers, wine and shots of different cocktails. my wife tried a limoncello drink that she thought was real good. too bad she got the last one so she couldnt order another. nwhat makes this restaurant cozy but large is the inside of the restaurant is broken up into smaller rooms. so you never see everyone who is dining there. you can just focus on your present company and the meal you are sharing. this also explains the being romantic and busy part. waiting for your table you see servers and patrons going back and forth. its not until you get seated into one of those smaller rooms that everything starts to slow down. nthe crowd that eats there is a very diverse crowd. from hipster guys and gals to men in suit and ties and women in dresses. young and old come here. nand they come for the atmosphere but mainly for the food. great italian fare. pizzas, pasta dishes, colorful salads. the food is amazing. house chop salad is great, pairs of different prepared bruschetta is great and the bolognese sausage dish that i had was so good. it was all delicious. if you come here. you will not be disappointed.', 'i am super happy with the service i received. i called and spoke with jerry he came out the same day and gave me an estimate which was very fair. they scheduled my tree trimming for the next day! alex was great. he introduced himself right from the start and made sure we were on the same page. he and his crew did a great job! they even cleaned everything up and left it looking nicer than before they came. i highly recommend them!!! and i will use them again!', 'i ordered custom counter tops and had them installed by lowes in my laundry room. the color was what i had been looking for in a quartz. the installers somehow scratched must had been with a saw the top of the counter top. i complained and they came out and fixed it by polishing a small section. now i have a shiny spot in the middle of the counter top. ni am so disappointed. i spent for this and see the shiny spot every time i walk through the room. they are functional, but this is so disappointing. dont have any custom work done.', 'these mother fuckers hit an ran my car! eye witness took down their cab number and license plate. your busted!', 'first, let me say that the customer service at the sedona location is very good. the technician more than competent. she gets five stars. n nmy problem is with billing and the website. as we made payments, we never got a statement reflecting the payments even though my husband asked for corrected invoices. also wrote two letters... no response. the invoice ascension were only on the site once and then disappeared. the results never showed up when we logged on. n nnow we are told its going to collection and well have to make payment arrangements with the agency. but they dont know who the agency is or what their procedures are. interesting because weve called three times and each time been told its going to collection tomorrow .', 'who cares if its a chain? as far as bang for your buck is concerned, outback has always been good in my book. it was a packed house when we got there, so we sat at the bar and paige was our bartender and she was great. she helped us get the table we wanted quickly and was very friendly. blake was our server and he was great as well. food was all very tasty. had bloomin onion, filet with wild mushroom sauce, and prime rib. while the prime rib was a little tough in some places, it was still very good overall. good prices, good food.', 'there are at least four starbucks in this airport this is the one in t just inside security checkpoint c by gates c c . n na surprisingly nice airport starbucks. when i was there, it was quiet without a line. there is a seating area with four tables and three sets of four armchairs. you could actually sit here and believe that you were at any starbucks, not inside an airport. n nthe place was well staffed i believe there were three employees , and my drinks came quickly. they had bananas when i was there, which was nice, plus a limited assortment of baked goods it was later in the day .', 'i love chocolate!!!!!!!!! n ni took my daughter here for her th birthday and she love it!!! we sat on the comfy couches and ordered the chocolate fondue and it was delicious it gave me the best sensation ever!!!! n nfor all you chocolate lovers i highly recommend you stop by here and order the chocolae fondue! n nthe people there are very friendly and give you great service!', 'it has been a long time since ive had frozen yogurt, but i fell in love again with this somewhat healthy treat after attending saturdays at selwyn. n nmy boyfriend and i went and filled up our cups with about different flavors and piled on toppings from fresh fruit to chocolate chips and caramel. we had a coupon, which was nice considering it was our first time. the next day i decided that i needed some more yoforia in my life and we drove the almost min drive back to selwyn ave for it. n na lover of great food and anything sweet, i got my fix of raspberry yogurt. its a great after dinner snack thats not too heavy, not to mention the atmosphere is perfect. you can sit outside and enjoy the weather, people watch, etc. definitely one of my new favorite places.', 'the first time i went here i thought it was a good yelp pick. the last time i went here i shelled out for a scramble without meat, and a large oj. if you come here with a party of four your tab would be close to . . for a large oj that was probably bought at costco for a gallon!? food is good, but not worth the high cost and wait considering the location is in an industrial area. i have been to hundreds of restaurants world wide and know what is a reasonable cost for your meal. diners and dives made it popular, but now i think they are gouging the customer for their product. cashier tried to justify costs, but the s just dont add up.', 'its an airport, small but had what it needed. planes.', 'were here because of a convention. first bad thing is the location. its far away from everything else that is fun. we walked back from the strip and its a full mile of rather dangerous and unpleasant walk on a sidewalk that smells of sewage next to speeding cars and a walking bridge that is befitting of a ghetto. n nthe novice black jack dealer was a little cute and mildly entertaining. she almost gave us push on a lost hand which the whole table laughed about. n nin the morning it took minutes for a hostess to acknowledge us in line to be seated at the half empty breakfast restaurant. we werent allowed to bring coffee from their own restaurant to the pool area. some guy didnt like us moving poolside chairs into a shade. n nits not one thing, but a collage of a bunch of wrong things that paints an ugly picture for this resort. we wont be back.', 'words cannot express the warm welcome and friendly nature of this business. i had the opportunity of working with k who was knowledgable and courteous. i had dropped my iphone in water, and he was able to fix the phone to take it from inoperable to working flawlessly. you are insane to go anywhere else. great price, great people, great service. i wish i could give it a . n n n n doug', 'i stopped in this nautica store to try and land some long sleeve fitted dress shirts, but left empty handed. n nim , lbs. it is hard to find shirts that dont look too bulky in the middle, but are still long enough in the arms. an ideally fitted shirt for my frame is a in the neck, in the arms and trim through the midsection. n nnautica, it turns out, has some really nice fitted dress shirts at this store marked down, but they only carry in the arms in a in the neck size. two of the girls there were very helpful trying to find the appropriate size, but after a quick check at the reference book, it turns out they didnt carry what i needed. n nthree stars for the two young ladies who made an effort to find what i needed, before they finally recommended i shop at calvin klein instead. n ntheir recommendation was heeded. nautica, ill sail you some other time.', 'stopped back in here tonight heres an update since its been about a year and a half. i had a regular whataburger . a small fries . . the dining room was clean comfortable, the service friendly, the sizes of the items right for the money. the burger was well topped, with lettuce, tomato, diced raw onions, on a warm, toasted bun. the flavor of the meat was quite ordinary though, fell well short of the best burgers in town, so its another stars for this completely ok but not special place.', 'very clean and not crowded on weekends. they do price match only with frys, safeway, albertson and basha.', 'i really wanted to love this place, but it just didnt happen at all. we got a to go order of potstickers , snow crab shrimp roll, and a salmon tempura roll. we were told it would be ready in minutes on a sunday about p.m. n to start, the place is like a broom closet. as you walk in, the register is at the far end of the restaurant with literally feet between the counter and the drink stand. while waiting in line to pay, we had to maneuver around the foot space x for the wait staff. n the chefs didnt even begin to make our order until minutes after our minute arrival time. after paying, we moved to stand by the hallway to the restrooms, still seemly in the way of everyone it was very uncomfortable. on to the food n the salmon tempura roll was a sad sight, but tasted okay. the crab shrimp roll the shrimp and avocado were fresh, but the crab looked like little hairs and was poorly represented. the potstickers gyoza were a pathetic excuse for their name. they were mushy and bland. even the dipping sauce served with them was a pale representation of what it should have been. n i know of many others that are much better than this place. they can serve sushi all day long, but ill never come back.', 'simply put...ive had better. i ordered two meals with fried rice. the rice contained hard pieces that were uneatable, yuck! crab ragoons had an imitation crab flavor and sadly to say, i think panda express does it better.', 'dismal, abject, revolting. these are words one would use to describe the contents of a garbage can, or a snuff film. you know nice, pleasant things that one would enjoy on a sunday afternoon. shogun however deserves none of this high praise. these words are a lofty goal by their standards. n ni was so unfortunate to collide unwillingly with this place one saturday for lunch and decided to order the unagi roll and the panko udon. i was expecting some common sense from the chef wank they picked up off the street, but even hope fails occasionally in an explosion of misery. the unagi roll was horrible. the rice was not fully cooked, the contents were soggy and tasted old. the sushi would have been better if the chef had taken the ingredients, put them down his pants, sat on them for minutes while riding a bull, and then vomited on the resulting creation. later the panko udon arrived, and it was even worse. i understand that it was panko breaded and not a tempura batter, but still it was absolutely horrendous. they could not have overcooked the vegetables, shrimp, and fish more. it was greasy, bland, insipid cooking that could not have been made better even if it were served with a diamond ring. the store bought, cheap as you can find udon was undercooked and had the texture of noodles that had been sitting for about minutes in a colander. these little beauties were served in a pool of horrific bottled tsuyu sauce that left a lingering chemical aftertaste that was just a delight to behold. n ni would not eat here again even if my scrotum were stapled to a chair and i was chained to a table. i have to give this place one star too many because yelp unfortunately has a one star minimum. i would even rate any fast food chain better than this place. i have had better airline food. n ncheers, nuntil then, get the beers in... njust not at shogun.', 'waited for an hour during lunch. they took my order, waited forever, and ended up having to leave without eating because i needed to get back to work.', 'the location of il fornaio is great...nice to be able to sit out and watch people in the casino. the service was also really great. n nhowever, although the food was good, i struggle to give more than stars, because i thought the price tag was really high for what we ordered.', 'still the best and for me, the only professional football team in the world...', 'this is an alright place if you havent experienced some of the much better places in arizona. i think it is somewhat overpriced compared to similar restaurants and the food isnt anything to rave about.', 'i am a fan of the deals you can get here, all that digging is so satisfying when you get designer items and you manage to find something that is either not damaged or something you can repair. that being said dealing with the other people makes me dislike people more than working at mcdonalds in high school. they have security guards who will kick you out if you are not following the rules when they put out new items, i have seen people steal items out of other peoples carts ect. this place is so not my cup of tea but there are definately great deals to be had if you like people more than i apparently do.', 'it had been a while since i dined at lawrys las vegas, but i craved a spinning salad and a bone in piece of prime rib. i made reservations on open table literally minutes prior to my reservation and had no problem getting in. n nonce greeted by the friendly staff we were escorted to a nice roomy corner booth with a view of the entire main dinning area. our waitress has worked here for years was friendly and funny. she took my drink order while we enjoyed the complimentary warm yummy bread. i placed an order of wild mushroom medley so the timing would coincide while arturo carved my request of the lawrys bone in prime rib cut and plated my mixed cream corn spinach, mashed potatoes and yorkshire pudding. the prime rib was delish, tender and flavorful it was that moment i realized why i unconsciously wanted to dine here! all the sides were perfect and the wild mushrooms were incredible. unfortunately i was so full i had to pass on dessert, so decided to walk over to starbucks and had a nightcap frappuccino. n nill definitely return to lawrys again for the traditional food, service and convenience.', 'as far as automatic, non do it yourself car washes, this is where youll get the bang for your buck and a quick wash. if thats what youre shooting for, this place has the whole routine down! n neven with a basic wash, theyll wipe down the interior and clean the insides of the windows. thats pretty cool, but they use ammonia based cleaners to get the residue to evaporate faster. thats fine when its used in your house, but prolonged or repeated use of the stuff will dry out the vinyl and rubber seals on your car. n nthey janked up all the seat settings slid them all back so that they can get in there and wipe the dash. again, thats cool given how quick they wipe it down, but annoying. even without paying for the stinky perfume, the car still smelled like it anyway. eww. n ni believe that a diy car wash like the place out in middleton or sun prairie would be a better clean for , given you have your own sponge, cloth, soap, and bucket. if youre short on time, octopus has got your back. like joyce said, it is what it is', 'the fish on the sushi gave my friend food poisoning. worse part is the manager is literally watching you from the cameras in the back. n nthe worst part is that if you order more of the same sushi they reduce the fish portion and increase the rice amount. i only tasted sticky rise!!!', 'words... osso bucco. best in town! wait, best ever! i usually have to call to see if theyre offering it for the night, but its phenomenal! no joke. its fantastic. i dont even like eating meat, and i will crave this dish! antonio and rudy behind the bar are amazing mixologists and have created some of the coolest cocktails ive ever had!', 'what is up with the hosts lately in restaurants. they have zero personality and really dont set a great first impression. anyhow lets get to food and service. carol is great and really overcomes the original impression left by the podium guards. we ordered a tomatoe caprisi appetizer and it was excellent! a new variation on a classic. tomatoes are spread out on the plate and has chopped tomaroes spread around. the new addition to this classic is fresh red onion and then a balsamic reduction and fresh basil. i could eat this dish as an main course but i dont have that much restraint. i orderes pasta franco and it was very food. the combination of olives artichoke hearts and sundried tomatoe makes this dish a little salt towards the end but it wasnt unexpected. i would order it again. carol is very attentive but never pushy and you should definitely ask for her. we dont dine here often enough but we will remedy that.', 'if i could give this place a negative rating i would. my wife, year old daughter and myself stopped in for lunch expecting a nice lunch. well, as we all know they play latin music in their establishments. on this particular day they decided to play whatever they wanted. while eating i noticed that there were f bombs ad s bombs being played over the speakers. i asked for the manager to complain and he gave me some excuse that they have no control over the music. bull shit!! i asked for the corporate number and gave them a call. turns out they have assigned stations that are to be played. n i have no complaint about baja itself, i do have an issue with this location. and for the little sharpy eye brow wearing mexican bitch. who the hell are you to tell my wife that my daughter doesnt look like here? you might want to keep you papers near by just incase a few of my ins buddies decide to stop by for lunch.', 'love the organ... sad to see this arizona historical treasure in such danger of mediocrity due to poor management. the pizza we had wasnt worth taking home. i didnt want to insult the cardboard box by putting pizza in it that is more tasteless than itself. fix yer food folks!!!', 'i absolutely love polished! i live about miles away and i pass hundreds of nail salons and i would never go anywhere but here. the color selection is like no other. i have never seen so many. it is always busy in here but i have never had to wait to get serviced. tina does my nails and she makes them look perfect each time. the receptionists arielle and brianna make everything go smoothly and they always greet you by name. whenever i have people in town i always take them to polished! i love it here!']
  # s_permmmmmmmmmmmmmmm ['cibo itself is a oxymoron. very cozy but large. very romantic but busy. i will explain that later. this italian restaurant is that but much more. on the corner of north th avenue and west filmore. at night, you will see a house lit up with strings of white lights and the sound of a guitar playing sweet melodies. ngetting there was a small challenge for me. not being from phoenix and not being familiar with side streets. my main route was using the freeway. which i am not a particular fan of. nthis night, friday, was filled with a lot of ambulances, cop cars and fire trucks with lights and sirens blazing. one incident, my wife counted around of these emergency vehicles going the other way on the freeway at the same time. i just pray that they all got there on time to help the people who were in need. ngetting closer to the restaurant. you can see the tall buildings of downtown. we were following the maps app but a lot of the streets are not well lit. so we missed a street or two. luckily we did find the restaurant. again the strings of white lights and the guitar music were a good indicator that we were here. plenty of parking on west filmore street. nbesides the front patio dining. they have a small bar once your inside. the bar itself holds, at most, individuals. a good selection of bottled beers, wine and shots of different cocktails. my wife tried a limoncello drink that she thought was real good. too bad she got the last one so she couldnt order another. nwhat makes this restaurant cozy but large is the inside of the restaurant is broken up into smaller rooms. so you never see everyone who is dining there. you can just focus on your present company and the meal you are sharing. this also explains the being romantic and busy part. waiting for your table you see servers and patrons going back and forth. its not until you get seated into one of those smaller rooms that everything starts to slow down. nthe crowd that eats there is a very diverse crowd. from hipster guys and gals to men in suit and ties and women in dresses. young and old come here. nand they come for the atmosphere but mainly for the food. great italian fare. pizzas, pasta dishes, colorful salads. the food is amazing. house chop salad is great, pairs of different prepared bruschetta is great and the bolognese sausage dish that i had was so good. it was all delicious. if you come here. you will not be disappointed.', 'i am super happy with the service i received. i called and spoke with jerry he came out the same day and gave me an estimate which was very fair. they scheduled my tree trimming for the next day! alex was great. he introduced himself right from the start and made sure we were on the same page. he and his crew did a great job! they even cleaned everything up and left it looking nicer than before they came. i highly recommend them!!! and i will use them again!', 'i ordered custom counter tops and had them installed by lowes in my laundry room. the color was what i had been looking for in a quartz. the installers somehow scratched must had been with a saw the top of the counter top. i complained and they came out and fixed it by polishing a small section. now i have a shiny spot in the middle of the counter top. ni am so disappointed. i spent for this and see the shiny spot every time i walk through the room. they are functional, but this is so disappointing. dont have any custom work done.', 'these mother fuckers hit an ran my car! eye witness took down their cab number and license plate. your busted!', 'first, let me say that the customer service at the sedona location is very good. the technician more than competent. she gets five stars. n nmy problem is with billing and the website. as we made payments, we never got a statement reflecting the payments even though my husband asked for corrected invoices. also wrote two letters... no response. the invoice ascension were only on the site once and then disappeared. the results never showed up when we logged on. n nnow we are told its going to collection and well have to make payment arrangements with the agency. but they dont know who the agency is or what their procedures are. interesting because weve called three times and each time been told its going to collection tomorrow .', 'who cares if its a chain? as far as bang for your buck is concerned, outback has always been good in my book. it was a packed house when we got there, so we sat at the bar and paige was our bartender and she was great. she helped us get the table we wanted quickly and was very friendly. blake was our server and he was great as well. food was all very tasty. had bloomin onion, filet with wild mushroom sauce, and prime rib. while the prime rib was a little tough in some places, it was still very good overall. good prices, good food.', 'there are at least four starbucks in this airport this is the one in t just inside security checkpoint c by gates c c . n na surprisingly nice airport starbucks. when i was there, it was quiet without a line. there is a seating area with four tables and three sets of four armchairs. you could actually sit here and believe that you were at any starbucks, not inside an airport. n nthe place was well staffed i believe there were three employees , and my drinks came quickly. they had bananas when i was there, which was nice, plus a limited assortment of baked goods it was later in the day .', 'i love chocolate!!!!!!!!! n ni took my daughter here for her th birthday and she love it!!! we sat on the comfy couches and ordered the chocolate fondue and it was delicious it gave me the best sensation ever!!!! n nfor all you chocolate lovers i highly recommend you stop by here and order the chocolae fondue! n nthe people there are very friendly and give you great service!', 'it has been a long time since ive had frozen yogurt, but i fell in love again with this somewhat healthy treat after attending saturdays at selwyn. n nmy boyfriend and i went and filled up our cups with about different flavors and piled on toppings from fresh fruit to chocolate chips and caramel. we had a coupon, which was nice considering it was our first time. the next day i decided that i needed some more yoforia in my life and we drove the almost min drive back to selwyn ave for it. n na lover of great food and anything sweet, i got my fix of raspberry yogurt. its a great after dinner snack thats not too heavy, not to mention the atmosphere is perfect. you can sit outside and enjoy the weather, people watch, etc. definitely one of my new favorite places.', 'the first time i went here i thought it was a good yelp pick. the last time i went here i shelled out for a scramble without meat, and a large oj. if you come here with a party of four your tab would be close to . . for a large oj that was probably bought at costco for a gallon!? food is good, but not worth the high cost and wait considering the location is in an industrial area. i have been to hundreds of restaurants world wide and know what is a reasonable cost for your meal. diners and dives made it popular, but now i think they are gouging the customer for their product. cashier tried to justify costs, but the s just dont add up.', 'its an airport, small but had what it needed. planes.', 'were here because of a convention. first bad thing is the location. its far away from everything else that is fun. we walked back from the strip and its a full mile of rather dangerous and unpleasant walk on a sidewalk that smells of sewage next to speeding cars and a walking bridge that is befitting of a ghetto. n nthe novice black jack dealer was a little cute and mildly entertaining. she almost gave us push on a lost hand which the whole table laughed about. n nin the morning it took minutes for a hostess to acknowledge us in line to be seated at the half empty breakfast restaurant. we werent allowed to bring coffee from their own restaurant to the pool area. some guy didnt like us moving poolside chairs into a shade. n nits not one thing, but a collage of a bunch of wrong things that paints an ugly picture for this resort. we wont be back.', 'words cannot express the warm welcome and friendly nature of this business. i had the opportunity of working with k who was knowledgable and courteous. i had dropped my iphone in water, and he was able to fix the phone to take it from inoperable to working flawlessly. you are insane to go anywhere else. great price, great people, great service. i wish i could give it a . n n n n doug', 'i stopped in this nautica store to try and land some long sleeve fitted dress shirts, but left empty handed. n nim , lbs. it is hard to find shirts that dont look too bulky in the middle, but are still long enough in the arms. an ideally fitted shirt for my frame is a in the neck, in the arms and trim through the midsection. n nnautica, it turns out, has some really nice fitted dress shirts at this store marked down, but they only carry in the arms in a in the neck size. two of the girls there were very helpful trying to find the appropriate size, but after a quick check at the reference book, it turns out they didnt carry what i needed. n nthree stars for the two young ladies who made an effort to find what i needed, before they finally recommended i shop at calvin klein instead. n ntheir recommendation was heeded. nautica, ill sail you some other time.', 'stopped back in here tonight heres an update since its been about a year and a half. i had a regular whataburger . a small fries . . the dining room was clean comfortable, the service friendly, the sizes of the items right for the money. the burger was well topped, with lettuce, tomato, diced raw onions, on a warm, toasted bun. the flavor of the meat was quite ordinary though, fell well short of the best burgers in town, so its another stars for this completely ok but not special place.', 'very clean and not crowded on weekends. they do price match only with frys, safeway, albertson and basha.', 'i really wanted to love this place, but it just didnt happen at all. we got a to go order of potstickers , snow crab shrimp roll, and a salmon tempura roll. we were told it would be ready in minutes on a sunday about p.m. n to start, the place is like a broom closet. as you walk in, the register is at the far end of the restaurant with literally feet between the counter and the drink stand. while waiting in line to pay, we had to maneuver around the foot space x for the wait staff. n the chefs didnt even begin to make our order until minutes after our minute arrival time. after paying, we moved to stand by the hallway to the restrooms, still seemly in the way of everyone it was very uncomfortable. on to the food n the salmon tempura roll was a sad sight, but tasted okay. the crab shrimp roll the shrimp and avocado were fresh, but the crab looked like little hairs and was poorly represented. the potstickers gyoza were a pathetic excuse for their name. they were mushy and bland. even the dipping sauce served with them was a pale representation of what it should have been. n i know of many others that are much better than this place. they can serve sushi all day long, but ill never come back.', 'simply put...ive had better. i ordered two meals with fried rice. the rice contained hard pieces that were uneatable, yuck! crab ragoons had an imitation crab flavor and sadly to say, i think panda express does it better.', 'dismal, abject, revolting. these are words one would use to describe the contents of a garbage can, or a snuff film. you know nice, pleasant things that one would enjoy on a sunday afternoon. shogun however deserves none of this high praise. these words are a lofty goal by their standards. n ni was so unfortunate to collide unwillingly with this place one saturday for lunch and decided to order the unagi roll and the panko udon. i was expecting some common sense from the chef wank they picked up off the street, but even hope fails occasionally in an explosion of misery. the unagi roll was horrible. the rice was not fully cooked, the contents were soggy and tasted old. the sushi would have been better if the chef had taken the ingredients, put them down his pants, sat on them for minutes while riding a bull, and then vomited on the resulting creation. later the panko udon arrived, and it was even worse. i understand that it was panko breaded and not a tempura batter, but still it was absolutely horrendous. they could not have overcooked the vegetables, shrimp, and fish more. it was greasy, bland, insipid cooking that could not have been made better even if it were served with a diamond ring. the store bought, cheap as you can find udon was undercooked and had the texture of noodles that had been sitting for about minutes in a colander. these little beauties were served in a pool of horrific bottled tsuyu sauce that left a lingering chemical aftertaste that was just a delight to behold. n ni would not eat here again even if my scrotum were stapled to a chair and i was chained to a table. i have to give this place one star too many because yelp unfortunately has a one star minimum. i would even rate any fast food chain better than this place. i have had better airline food. n ncheers, nuntil then, get the beers in... njust not at shogun.', 'waited for an hour during lunch. they took my order, waited forever, and ended up having to leave without eating because i needed to get back to work.', 'the location of il fornaio is great...nice to be able to sit out and watch people in the casino. the service was also really great. n nhowever, although the food was good, i struggle to give more than stars, because i thought the price tag was really high for what we ordered.', 'still the best and for me, the only professional football team in the world...', 'this is an alright place if you havent experienced some of the much better places in arizona. i think it is somewhat overpriced compared to similar restaurants and the food isnt anything to rave about.', 'i am a fan of the deals you can get here, all that digging is so satisfying when you get designer items and you manage to find something that is either not damaged or something you can repair. that being said dealing with the other people makes me dislike people more than working at mcdonalds in high school. they have security guards who will kick you out if you are not following the rules when they put out new items, i have seen people steal items out of other peoples carts ect. this place is so not my cup of tea but there are definately great deals to be had if you like people more than i apparently do.', 'it had been a while since i dined at lawrys las vegas, but i craved a spinning salad and a bone in piece of prime rib. i made reservations on open table literally minutes prior to my reservation and had no problem getting in. n nonce greeted by the friendly staff we were escorted to a nice roomy corner booth with a view of the entire main dinning area. our waitress has worked here for years was friendly and funny. she took my drink order while we enjoyed the complimentary warm yummy bread. i placed an order of wild mushroom medley so the timing would coincide while arturo carved my request of the lawrys bone in prime rib cut and plated my mixed cream corn spinach, mashed potatoes and yorkshire pudding. the prime rib was delish, tender and flavorful it was that moment i realized why i unconsciously wanted to dine here! all the sides were perfect and the wild mushrooms were incredible. unfortunately i was so full i had to pass on dessert, so decided to walk over to starbucks and had a nightcap frappuccino. n nill definitely return to lawrys again for the traditional food, service and convenience.', 'as far as automatic, non do it yourself car washes, this is where youll get the bang for your buck and a quick wash. if thats what youre shooting for, this place has the whole routine down! n neven with a basic wash, theyll wipe down the interior and clean the insides of the windows. thats pretty cool, but they use ammonia based cleaners to get the residue to evaporate faster. thats fine when its used in your house, but prolonged or repeated use of the stuff will dry out the vinyl and rubber seals on your car. n nthey janked up all the seat settings slid them all back so that they can get in there and wipe the dash. again, thats cool given how quick they wipe it down, but annoying. even without paying for the stinky perfume, the car still smelled like it anyway. eww. n ni believe that a diy car wash like the place out in middleton or sun prairie would be a better clean for , given you have your own sponge, cloth, soap, and bucket. if youre short on time, octopus has got your back. like joyce said, it is what it is', 'the fish on the sushi gave my friend food poisoning. worse part is the manager is literally watching you from the cameras in the back. n nthe worst part is that if you order more of the same sushi they reduce the fish portion and increase the rice amount. i only tasted sticky rise!!!', 'words... osso bucco. best in town! wait, best ever! i usually have to call to see if theyre offering it for the night, but its phenomenal! no joke. its fantastic. i dont even like eating meat, and i will crave this dish! antonio and rudy behind the bar are amazing mixologists and have created some of the coolest cocktails ive ever had!', 'what is up with the hosts lately in restaurants. they have zero personality and really dont set a great first impression. anyhow lets get to food and service. carol is great and really overcomes the original impression left by the podium guards. we ordered a tomatoe caprisi appetizer and it was excellent! a new variation on a classic. tomatoes are spread out on the plate and has chopped tomaroes spread around. the new addition to this classic is fresh red onion and then a balsamic reduction and fresh basil. i could eat this dish as an main course but i dont have that much restraint. i orderes pasta franco and it was very food. the combination of olives artichoke hearts and sundried tomatoe makes this dish a little salt towards the end but it wasnt unexpected. i would order it again. carol is very attentive but never pushy and you should definitely ask for her. we dont dine here often enough but we will remedy that.', 'if i could give this place a negative rating i would. my wife, year old daughter and myself stopped in for lunch expecting a nice lunch. well, as we all know they play latin music in their establishments. on this particular day they decided to play whatever they wanted. while eating i noticed that there were f bombs ad s bombs being played over the speakers. i asked for the manager to complain and he gave me some excuse that they have no control over the music. bull shit!! i asked for the corporate number and gave them a call. turns out they have assigned stations that are to be played. n i have no complaint about baja itself, i do have an issue with this location. and for the little sharpy eye brow wearing mexican bitch. who the hell are you to tell my wife that my daughter doesnt look like here? you might want to keep you papers near by just incase a few of my ins buddies decide to stop by for lunch.', 'love the organ... sad to see this arizona historical treasure in such danger of mediocrity due to poor management. the pizza we had wasnt worth taking home. i didnt want to insult the cardboard box by putting pizza in it that is more tasteless than itself. fix yer food folks!!!', 'i absolutely love polished! i live about miles away and i pass hundreds of nail salons and i would never go anywhere but here. the color selection is like no other. i have never seen so many. it is always busy in here but i have never had to wait to get serviced. tina does my nails and she makes them look perfect each time. the receptionists arielle and brianna make everything go smoothly and they always greet you by name. whenever i have people in town i always take them to polished! i love it here!']

  # we need to read y_b, x_perm, and s_perm from another dataset

  return x,x_perm,s,s_perm,y_a,y_b

'''
The function `collate_fn_feature_mix` takes a batch of data as input and performs several operations on that batch. Here's a breakdown of what each line does:

1. `batch_size = len(batch)`: Determines the size of the batch by getting the length of the input `batch`, which is expected to be a list.

2. `perm_index = torch.randperm(batch_size)`: Generates a random permutation of numbers from 0 to `batch_size - 1`. This creates a tensor `perm_index` containing a random order of indices.

3. `y_a = torch.LongTensor([item[0] for item in batch])`: Extracts the first item from each element in the `batch` list and creates a tensor `y_a` from them. This line assumes that the first item in each element represents a label or a target.

4. `y_b = y_a[perm_index]`: Shuffles the elements of `y_a` according to the order specified in `perm_index`. This line creates a tensor `y_b` that represents the shuffled version of `y_a`.

5. `x = [item[1] for item in batch]`: Extracts the second item from each element in the `batch` list and stores them in a list `x`. This assumes that the second item represents a feature or input data.

6. `s = [item[2] for item in batch]`: Extracts the third item from each element in the `batch` list and stores them in a list `s`. This assumes that the third item represents another feature or input data.

7. `s_perm = [s[perm_index[i]] for i in range(batch_size)]`: Creates a list `s_perm` where the elements from the `s` list are shuffled according to the order specified in `perm_index`. This line ensures that the elements in `s_perm` are shuffled consistently with the shuffling of the labels in `y_b`.

8. `x_perm = [x[perm_index[i]] for i in range(batch_size)]`: Creates a list `x_perm` where the elements from the `x` list are shuffled according to the order specified in `perm_index`. This line ensures that the elements in `x_perm` are shuffled consistently with the shuffling of the labels in `y_b`.

9. Finally, the function returns `x`, `x_perm`, `s`, `s_perm`, `y_a`, and `y_b`. These represent the original and shuffled versions of the input features `x` and `s`, as well as the original and shuffled versions of the labels `y_a` and `y_b`, respectively.



'''








def collate_fn_feature_mix_cartography(batch):
    #batch_size = len(batch1)
    batch1, batch2 = [], []
    for i in batch:
       batch1.append(i[0])
       batch2.append(i[1])    

    y_a = torch.LongTensor([item[0] for item in batch1 if isinstance(item, tuple)])
    y_b = torch.LongTensor([item[0] for item in batch2 if isinstance(item, tuple)])
    x = [item[1] for item in batch1 if isinstance(item, tuple)]

    s = [item[2] for item in batch1 if isinstance(item, tuple)]
    s_perm = [item[2] for item in batch2 if isinstance(item, tuple)]
    x_perm = [item[1] for item in batch2 if isinstance(item, tuple)]
    
    return x,x_perm,s,s_perm,y_a,y_b
    



def collate_fn(batch):
    batch_size = len(batch)
    perm_index = torch.randperm(batch_size)
    y_a = torch.LongTensor([item[0] for item in batch])
    # print(y_a)
    # print(batch)
    y_b = y_a[perm_index]
    x = [item[1] for item in batch]
    
    s = [item[2] for item in batch]

    # x_ids = tokenizer(x, padding = 'max_length', max_length = 200, truncation = True, return_tensors="pt")["input_ids"]
    # s_ids = tokenizer(s, padding = 'max_length', max_length = 200, truncation = True, return_tensors="pt")["input_ids"]

    return x, s, y_a, y_b